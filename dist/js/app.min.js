"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}var body=document.body,toggleBtn=document.querySelector(".calc__upper-right-toggle-btn"),toggleCircle=document.querySelector(".calc__upper-right-toggle-btn::before"),displayEl=document.querySelector(".calc__screen-display"),numberKeys=document.querySelectorAll("[data-number]"),operandKeys=document.querySelectorAll("[data-operand]"),equalsKey=document.querySelector("[data-equals]"),resetKey=document.querySelector("[data-reset]"),deleteKey=document.querySelector("[data-delete]"),Toggler=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"toggleState",1),toggleBtn.addEventListener("click",this.toggle.bind(this))}return _createClass(e,[{key:"toggle",value:function(){toggleBtn.classList.remove("second-state","third-state"),this.toggleState++,2===this.toggleState&&toggleBtn.classList.add("second-state"),3===this.toggleState&&toggleBtn.classList.add("third-state"),4===this.toggleState&&(this.toggleState=1),document.documentElement.setAttribute("data-theme","theme-".concat(this.toggleState))}}]),e}(),Calculator=function(){function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"currentNumber",""),_defineProperty(this,"previousNumber",0),_defineProperty(this,"lastOperationNum",0),_defineProperty(this,"currentOperand",void 0),_defineProperty(this,"isLastOperationEqual",!1),new Toggler;numberKeys.forEach(function(e){return e.addEventListener("click",t.addNum.bind(t))}),operandKeys.forEach(function(e){return e.addEventListener("click",t.doOperation.bind(t))}),deleteKey.addEventListener("click",this.delete.bind(this)),equalsKey.addEventListener("click",this.equals.bind(this)),resetKey.addEventListener("click",this.reset.bind(this))}return _createClass(e,[{key:"displayNum",value:function(){""===this.currentNumber?displayEl.textContent=0:displayEl.textContent=this.currentNumber}},{key:"addNum",value:function(e){e=e.target.textContent;13<=this.currentNumber.length||"."===e&&this.currentNumber.includes(".")||0==+e&&0==+this.currentNumber||(this.currentNumber+=e,this.displayNum())}},{key:"delete",value:function(){this.currentNumber=String(this.currentNumber).slice(0,-1),this.displayNum()}},{key:"doOperation",value:function(e){this.previousNumber&&this.currentNumber&&this.equals(),(this.currentOperand!==e.target.textContent||this.isLastOperationEqual)&&this.currentNumber&&(this.isLastOperationEqual=!1,this.currentOperand=e.target.textContent,this.previousNumber=this.currentNumber,this.currentNumber="")}},{key:"handleOperations",value:function(e,t){"+"===this.currentOperand&&(this.currentNumber=+e+ +t),"-"===this.currentOperand&&(this.currentNumber=+e-+t),"x"===this.currentOperand&&(this.currentNumber=+e*+t),"/"===this.currentOperand&&(this.currentNumber=+e/+t),this.currentNumber=String(this.currentNumber)}},{key:"equals",value:function(){+this.currentNumber&&(this.isLastOperationEqual||this.isLastOperationEqual||(this.lastOperationNum=this.currentNumber,this.handleOperations(this.previousNumber,this.currentNumber)),this.previousNumber=0,this.isLastOperationEqual&&(console.log(this.lastOperationNum),this.handleOperations(this.currentNumber,this.lastOperationNum)),this.displayNum(),this.isLastOperationEqual=!0)}},{key:"reset",value:function(){this.toggleState=1,this.currentNumber="",this.previousNumber=0,this.lastOperationNum=0,this.currentOperand,this.isLastOperationEqual=!1,displayEl.textContent=0}}]),e}(),calculator=new Calculator;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJfdHlwZW9mIiwibyIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX2RlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJfdG9Qcm9wZXJ0eUtleSIsImtleSIsIl9jcmVhdGVDbGFzcyIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsIl9kZWZpbmVQcm9wZXJ0eSIsIm9iaiIsInZhbHVlIiwidCIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsInIiLCJlIiwidG9QcmltaXRpdmUiLCJOdW1iZXIiLCJjYWxsIiwiYm9keSIsInRvZ2dsZUJ0biIsInRvZ2dsZUNpcmNsZSIsImRpc3BsYXlFbCIsInF1ZXJ5U2VsZWN0b3IiLCJudW1iZXJLZXlzIiwicXVlcnlTZWxlY3RvckFsbCIsImRvY3VtZW50Iiwib3BlcmFuZEtleXMiLCJUb2dnbGVyIiwiZGVsZXRlS2V5IiwiYWRkRXZlbnRMaXN0ZW5lciIsInRoaXMiLCJ0b2dnbGUiLCJiaW5kIiwicmVtb3ZlIiwidG9nZ2xlU3RhdGUiLCJhZGQiLCJjbGFzc0xpc3QiLCJkb2N1bWVudEVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJDYWxjdWxhdG9yIiwiX3RoaXMiLCJhZGROdW0iLCJkb09wZXJhdGlvbiIsImVxdWFsc0tleSIsInJlc2V0S2V5IiwicmVzZXQiLCJjdXJyZW50TnVtYmVyIiwidGV4dENvbnRlbnQiLCJudW0iLCJpbmNsdWRlcyIsImRpc3BsYXlOdW0iLCJzbGljZSIsInByZXZpb3VzTnVtYmVyIiwiZXF1YWxzIiwiY3VycmVudE9wZXJhbmQiLCJpc0xhc3RPcGVyYXRpb25FcXVhbCIsInByZXZpb3VzT3BlcmF0aW9uTnVtYmVyIiwib3BlcmF0aW9uTnVtYmVyIiwibGFzdE9wZXJhdGlvbk51bSIsImhhbmRsZU9wZXJhdGlvbnMiLCJjb25zb2xlIiwiY2FsY3VsYXRvciJdLCJtYXBwaW5ncyI6IkFBQUEsYUFBWSxTQUFBQSxRQUFBQyxHQUFBLE9BQUFELFFBQUEsWUFBQSxPQUFBRSxRQUFBLFVBQUEsT0FBQUEsT0FBQUMsU0FBQSxTQUFBRixHQUFBLE9BQUEsT0FBQUEsQ0FBQSxFQUFBLFNBQUFBLEdBQUEsT0FBQUEsR0FBQSxZQUFBLE9BQUFDLFFBQUFELEVBQUFHLGNBQUFGLFFBQUFELElBQUFDLE9BQUFHLFVBQUEsU0FBQSxPQUFBSixDQUFBLEdBQUFBLENBQUEsQ0FBQSxDQUFBLFNBQUFLLGdCQUFBQyxFQUFBQyxHQUFBLEdBQUEsRUFBQUQsYUFBQUMsR0FBQSxNQUFBLElBQUFDLFVBQUEsbUNBQUEsQ0FBQSxDQUFBLFNBQUFDLGtCQUFBQyxFQUFBQyxHQUFBLElBQUEsSUFBQUMsRUFBQSxFQUFBQSxFQUFBRCxFQUFBRSxPQUFBRCxDQUFBLEdBQUEsQ0FBQSxJQUFBRSxFQUFBSCxFQUFBQyxHQUFBRSxFQUFBQyxXQUFBRCxFQUFBQyxZQUFBLENBQUEsRUFBQUQsRUFBQUUsYUFBQSxDQUFBLEVBQUEsVUFBQUYsSUFBQUEsRUFBQUcsU0FBQSxDQUFBLEdBQUFDLE9BQUFDLGVBQUFULEVBQUFVLGVBQUFOLEVBQUFPLEdBQUEsRUFBQVAsQ0FBQSxDQUFBLENBQUEsQ0FBQSxTQUFBUSxhQUFBZixFQUFBZ0IsRUFBQUMsR0FBQSxPQUFBRCxHQUFBZCxrQkFBQUYsRUFBQUgsVUFBQW1CLENBQUEsRUFBQUMsR0FBQWYsa0JBQUFGLEVBQUFpQixDQUFBLEVBQUFOLE9BQUFDLGVBQUFaLEVBQUEsWUFBQSxDQUFBVSxTQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUFWLENBQUEsQ0FBQSxTQUFBa0IsZ0JBQUFDLEVBQUFMLEVBQUFNLEdBQUEsT0FBQU4sRUFBQUQsZUFBQUMs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LENBQUFDLEdBQ3hCLE1BQUEzQixLQUFBd0IsaUJBQUFuRCxLQUFBMkMsY0FBQSxDQUFBVSxFQUFBLENBQUFDLEdBR3dCLE1BQXZCM0IsS0FBSXdCLGlCQU9GeEIsS0FOQWdCLGNBQWtCLENBQUFVLEVBQTJCLENBQUFDLEdBRXhCLE1BQXZCM0IsS0FBSXdCLGlCQU9GeEIsS0FOQWdCLGNBQWtCLENBQUFVLEVBQTJCLENBQUFDLEdBUS9DM0IsS0FOQWdCLGNBQVNRLE9BQWN4QixLQUFRZ0IsYUFBRSxDQU9uQyxDQUFDLEVBQUEsQ0FBQTNDLElBQUEsU0FBQU0sTUFFRCxXQUxJLENBQUFxQixLQUFLZ0IsZ0JBQ1BoQixLQUFBeUIsc0JBQ0tULEtBQUFBLHVCQUNQaEIsS0FBQTRCLGlCQUFBNUIsS0FBQWdCLGNBQUNoQixLQUFBNkIsaUJBQUE3QixLQUFBc0IsZUFBQXRCLEtBQUFnQixhQUFBLEdBQUFyQyxLQUFBMkMsZUFFREMsRUFFRXZCLEtBQUt5Qix1QkFRSEssUUFOT0YsSUFBQUEsS0FBQUEsZ0JBQXdCWixFQU8vQmhCLEtBTkU2QixpQkFBS0EsS0FBaUJiLGNBQUtNLEtBQWdCTSxnQkFBa0IsR0FTakU1QixLQUxBb0IsV0FBU0ssRUFNVHpCLEtBTEU4QixxQkFBaUJGLENBQUFBLEVBTXJCLENBQUMsRUFBQSxDQUFBdkQsSUFBQSxRQUFBTSxNQUVELFdBQ0VxQixLQUpBSSxZQUFLcUIsRUFDUHpCLEtBQUFnQixjQUFBLEdBQUNoQixLQUFBc0IsZUFBQSxFQUFBakQsS0FBQXVELGlCQUFBLEVBQUFqRCxLQUFBNkMsZUFRQ3hCLEtBTEF5QixxQkFBb0IsQ0FBQSxFQU1wQmxDLFVBTEt5QixZQUFnQixDQU12QixDQUFDLEVBQUEsRUFBQVAsQ0FBQSxFQUFBLEVBRkNzQixXQUFLTixJQUFBQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5jb25zdCBib2R5ID0gZG9jdW1lbnQuYm9keTtcclxuY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYWxjX191cHBlci1yaWdodC10b2dnbGUtYnRuXCIpO1xyXG5jb25zdCB0b2dnbGVDaXJjbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLmNhbGNfX3VwcGVyLXJpZ2h0LXRvZ2dsZS1idG46OmJlZm9yZVwiXHJcbik7XHJcbmNvbnN0IGRpc3BsYXlFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FsY19fc2NyZWVuLWRpc3BsYXlcIik7XHJcbmNvbnN0IG51bWJlcktleXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtbnVtYmVyXVwiKTtcclxuY29uc3Qgb3BlcmFuZEtleXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtb3BlcmFuZF1cIik7XHJcbmNvbnN0IGVxdWFsc0tleSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbZGF0YS1lcXVhbHNdXCIpO1xyXG5jb25zdCByZXNldEtleSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbZGF0YS1yZXNldF1cIik7XHJcbmNvbnN0IGRlbGV0ZUtleSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbZGF0YS1kZWxldGVdXCIpO1xyXG5cclxuY2xhc3MgVG9nZ2xlciB7XHJcbiAgdG9nZ2xlU3RhdGUgPSAxO1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdG9nZ2xlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZSgpIHtcclxuICAgIHRvZ2dsZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwic2Vjb25kLXN0YXRlXCIsIFwidGhpcmQtc3RhdGVcIik7XHJcbiAgICB0aGlzLnRvZ2dsZVN0YXRlKys7XHJcbiAgICBpZiAodGhpcy50b2dnbGVTdGF0ZSA9PT0gMikge1xyXG4gICAgICB0b2dnbGVCdG4uY2xhc3NMaXN0LmFkZChcInNlY29uZC1zdGF0ZVwiKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnRvZ2dsZVN0YXRlID09PSAzKSB7XHJcbiAgICAgIHRvZ2dsZUJ0bi5jbGFzc0xpc3QuYWRkKFwidGhpcmQtc3RhdGVcIik7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy50b2dnbGVTdGF0ZSA9PT0gNCkgdGhpcy50b2dnbGVTdGF0ZSA9IDE7XHJcblxyXG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNldEF0dHJpYnV0ZShcclxuICAgICAgXCJkYXRhLXRoZW1lXCIsXHJcbiAgICAgIGB0aGVtZS0ke3RoaXMudG9nZ2xlU3RhdGV9YFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuY2xhc3MgQ2FsY3VsYXRvciB7XHJcbiAgY3VycmVudE51bWJlciA9IFwiXCI7XHJcbiAgcHJldmlvdXNOdW1iZXIgPSAwO1xyXG4gIGxhc3RPcGVyYXRpb25OdW0gPSAwO1xyXG4gIGN1cnJlbnRPcGVyYW5kO1xyXG4gIGlzTGFzdE9wZXJhdGlvbkVxdWFsID0gZmFsc2U7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBjb25zdCB0b2dnbGVyID0gbmV3IFRvZ2dsZXIoKTtcclxuICAgIG51bWJlcktleXMuZm9yRWFjaCgoa2V5KSA9PlxyXG4gICAgICBrZXkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuYWRkTnVtLmJpbmQodGhpcykpXHJcbiAgICApO1xyXG4gICAgb3BlcmFuZEtleXMuZm9yRWFjaCgoa2V5KSA9PlxyXG4gICAgICBrZXkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZG9PcGVyYXRpb24uYmluZCh0aGlzKSlcclxuICAgICk7XHJcbiAgICBkZWxldGVLZXkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuZGVsZXRlLmJpbmQodGhpcykpO1xyXG4gICAgZXF1YWxzS2V5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmVxdWFscy5iaW5kKHRoaXMpKTtcclxuICAgIHJlc2V0S2V5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnJlc2V0LmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgZGlzcGxheU51bSgpIHtcclxuICAgIGlmICh0aGlzLmN1cnJlbnROdW1iZXIgPT09IFwiXCIpIHtcclxuICAgICAgZGlzcGxheUVsLnRleHRDb250ZW50ID0gMDtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZGlzcGxheUVsLnRleHRDb250ZW50ID0gdGhpcy5jdXJyZW50TnVtYmVyO1xyXG4gIH1cclxuXHJcbiAgYWRkTnVtKGUpIHtcclxuICAgIGNvbnN0IG51bSA9IGUudGFyZ2V0LnRleHRDb250ZW50O1xyXG4gICAgaWYgKHRoaXMuY3VycmVudE51bWJlci5sZW5ndGggPj0gMTMpIHJldHVybjsgLy8gcHJldmVudGluZyB0b28gbG9uZyBpbnB1dFxyXG4gICAgaWYgKG51bSA9PT0gXCIuXCIgJiYgdGhpcy5jdXJyZW50TnVtYmVyLmluY2x1ZGVzKFwiLlwiKSkgcmV0dXJuOyAvLyBwcmV2ZW50aW5nIG11bHRpcGxlIGRvdHNcclxuICAgIGlmICgrbnVtID09PSAwICYmICt0aGlzLmN1cnJlbnROdW1iZXIgPT09IDApIHJldHVybjsgLy8gcHJldmVudGluZyBtdWx0aXBsZSB6ZXJvcyBpbiBmcm9udFxyXG4gICAgdGhpcy5jdXJyZW50TnVtYmVyICs9IG51bTtcclxuICAgIHRoaXMuZGlzcGxheU51bSgpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKCkge1xyXG4gICAgdGhpcy5jdXJyZW50TnVtYmVyID0gU3RyaW5nKHRoaXMuY3VycmVudE51bWJlcikuc2xpY2UoMCwgLTEpO1xyXG4gICAgdGhpcy5kaXNwbGF5TnVtKCk7XHJcbiAgfVxyXG5cclxuICBkb09wZXJhdGlvbihlKSB7XHJcbiAgICBpZiAodGhpcy5wcmV2aW91c051bWJlciAmJiB0aGlzLmN1cnJlbnROdW1iZXIpIHRoaXMuZXF1YWxzKCk7XHJcbiAgICBpZiAoXHJcbiAgICAgIHRoaXMuY3VycmVudE9wZXJhbmQgPT09IGUudGFyZ2V0LnRleHRDb250ZW50ICYmXHJcbiAgICAgICF0aGlzLmlzTGFzdE9wZXJhdGlvbkVxdWFsXHJcbiAgICApXHJcbiAgICAgIHJldHVybjtcclxuICAgIGlmICghdGhpcy5jdXJyZW50TnVtYmVyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmlzTGFzdE9wZXJhdGlvbkVxdWFsID0gZmFsc2U7XHJcbiAgICB0aGlzLmN1cnJlbnRPcGVyYW5kID0gZS50YXJnZXQudGV4dENvbnRlbnQ7XHJcbiAgICB0aGlzLnByZXZpb3VzTnVtYmVyID0gdGhpcy5jdXJyZW50TnVtYmVyO1xyXG4gICAgdGhpcy5jdXJyZW50TnVtYmVyID0gXCJcIjtcclxuICB9XHJcblxyXG4gIGhhbmRsZU9wZXJhdGlvbnMocHJldmlvdXNPcGVyYXRpb25OdW1iZXIsIG9wZXJhdGlvbk51bWJlcikge1xyXG4gICAgaWYgKHRoaXMuY3VycmVudE9wZXJhbmQgPT09IFwiK1wiKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudE51bWJlciA9ICtwcmV2aW91c09wZXJhdGlvbk51bWJlciArICtvcGVyYXRpb25OdW1iZXI7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5jdXJyZW50T3BlcmFuZCA9PT0gXCItXCIpIHtcclxuICAgICAgdGhpcy5jdXJyZW50TnVtYmVyID0gK3ByZXZpb3VzT3BlcmF0aW9uTnVtYmVyIC0gK29wZXJhdGlvbk51bWJlcjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmN1cnJlbnRPcGVyYW5kID09PSBcInhcIikge1xyXG4gICAgICB0aGlzLmN1cnJlbnROdW1iZXIgPSArcHJldmlvdXNPcGVyYXRpb25OdW1iZXIgKiArb3BlcmF0aW9uTnVtYmVyO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY3VycmVudE9wZXJhbmQgPT09IFwiL1wiKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudE51bWJlciA9ICtwcmV2aW91c09wZXJhdGlvbk51bWJlciAvICtvcGVyYXRpb25OdW1iZXI7XHJcbiAgICB9XHJcbiAgICB0aGlzLmN1cnJlbnROdW1iZXIgPSBTdHJpbmcodGhpcy5jdXJyZW50TnVtYmVyKTtcclxuICB9XHJcblxyXG4gIGVxdWFscygpIHtcclxuICAgIGlmICghK3RoaXMuY3VycmVudE51bWJlcikgcmV0dXJuO1xyXG4gICAgaWYgKCF0aGlzLmlzTGFzdE9wZXJhdGlvbkVxdWFsKVxyXG4gICAgICBpZiAoIXRoaXMuaXNMYXN0T3BlcmF0aW9uRXF1YWwpIHtcclxuICAgICAgICB0aGlzLmxhc3RPcGVyYXRpb25OdW0gPSB0aGlzLmN1cnJlbnROdW1iZXI7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVPcGVyYXRpb25zKHRoaXMucHJldmlvdXNOdW1iZXIsIHRoaXMuY3VycmVudE51bWJlcik7XHJcbiAgICAgIH1cclxuICAgIHRoaXMucHJldmlvdXNOdW1iZXIgPSAwO1xyXG5cclxuICAgIGlmICh0aGlzLmlzTGFzdE9wZXJhdGlvbkVxdWFsKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMubGFzdE9wZXJhdGlvbk51bSk7XHJcbiAgICAgIHRoaXMuaGFuZGxlT3BlcmF0aW9ucyh0aGlzLmN1cnJlbnROdW1iZXIsIHRoaXMubGFzdE9wZXJhdGlvbk51bSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaXNwbGF5TnVtKCk7XHJcbiAgICB0aGlzLmlzTGFzdE9wZXJhdGlvbkVxdWFsID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHJlc2V0KCkge1xyXG4gICAgdGhpcy50b2dnbGVTdGF0ZSA9IDE7XHJcbiAgICB0aGlzLmN1cnJlbnROdW1iZXIgPSBcIlwiO1xyXG4gICAgdGhpcy5wcmV2aW91c051bWJlciA9IDA7XHJcbiAgICB0aGlzLmxhc3RPcGVyYXRpb25OdW0gPSAwO1xyXG4gICAgdGhpcy5jdXJyZW50T3BlcmFuZDtcclxuICAgIHRoaXMuaXNMYXN0T3BlcmF0aW9uRXF1YWwgPSBmYWxzZTtcclxuICAgIGRpc3BsYXlFbC50ZXh0Q29udGVudCA9IDA7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBjYWxjdWxhdG9yID0gbmV3IENhbGN1bGF0b3IoKTtcclxuIl19
